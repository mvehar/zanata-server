<!--
  Copyright 2015, Red Hat, Inc. and individual contributors
  as indicated by the @author tags. See the copyright.txt file in the
  distribution for a full listing of individual contributors.

  This is free software; you can redistribute it and/or modify it
  under the terms of the GNU Lesser General Public License as
  published by the Free Software Foundation; either version 2.1 of
  the License, or (at your option) any later version.

  This software is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
  Lesser General Public License for more details.

  You should have received a copy of the GNU Lesser General Public
  License along with this software; if not, write to the Free
  Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
  02110-1301 USA, or see the FSF site: http://www.fsf.org.
  -->
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
        xmlns:s="http://jboss.org/schema/seam/taglib"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:zanata="http://java.sun.com/jsf/composite/zanata"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:a4j="http://richfaces.org/a4j"
        xmlns:rich="http://richfaces.org/rich">

  <div class="panel l--push-top-1">
    <div class="panel__header">
      <div class="panel__header__actions">
        <ui:param name="canManageMembers" value="#{identity.hasPermission(projectHome.instance, 'manage-members') or identity.hasPermission(projectHome.instance, 'manage-translation-members')}"/>
        <s:fragment rendered="#{canManageMembers}">
          <button class="button button--primary panel__header__button"
              data-toggle="modal"
              data-target="#modal-add-someone">
            <i class="i i--plus"></i> #{msgs['jsf.people.AddSomeone']}
          </button>
        </s:fragment>

        <zanata:sortlist id="project-people_sorting"
          sortAction="#{projectHomeAction.peopleFilterComparator.sortPeopleList()}"
          render="people_form, peopleSearch-pager, peopleSearch-page-info, peopleSearchBottom-pager, peopleSearchBottom-page-info"
          oncomplete="refreshTooltip('#{rich:clientId('people_form')}')"
          sortingList="#{projectHomeAction.peopleSortingList}"
          onbegin="clearHTML('#{rich:clientId('people_form')}')"
          status="peopleTab-peopleLoader"/>

        <!-- TODO this needs a bunch of params to customize it -->
        <ui:decorate template="person-permissions-modal.xhtml">
          <ui:param name="id" value="modal-add-someone"/>
          <ui:param name="title" value="#{msgs['jsf.people.AddSomeone']}"/>

          <!-- TODO use different field for this -->
          <ui:param name="memberships" value="#{projectHomeAction.permissionDialogData}"/>
          <!-- this property will allow the dialog to show the correct
               starting permissions, and will be the value used when the
               dialog is submitted.
               Need to retrieve a PersonProjectMemberships from projectHome
               representing the correct person. -->
          <!-- use ui:define, access in template as <ui:insert name="definedName"/>-->
          <ui:define name="testDefine">
            <p>Then just some content goes in here</p>
          </ui:define>
        </ui:decorate>

        <ui:decorate template="person-permissions-modal.xhtml">
          <ui:param name="id" value="modal-manage-permissions"/>
          <ui:param name="title" value="#{msgs['jsf.projectPermissions.ManagePermissions']}"/>

          <ui:param name="memberships" value="#{projectHomeAction.permissionDialogData}"/>
          <!-- this property will allow the dialog to show the correct
               starting permissions, and will be the value used when the
               dialog is submitted.
               Need to retrieve a PersonProjectMemberships from projectHome
               representing the correct person. -->
          <!-- use ui:define, access in template as <ui:insert name="definedName"/>-->
          <ui:define name="testDefine">
            <p>Then just some content goes in here</p>
          </ui:define>
          </ui:decorate>
      </div>
      <h2 class="panel__heading">#{msgs['jsf.People']}</h2>
    </div>

    <div class="panel__sub-header js-reveal">
      <zanata:list-filter status="peopleTab-peopleLoader"
        listId="people_form" iconClass="i--users"
        render="people_form, peopleSearchBottom-pager, peopleSearchBottom-page-info"
        id="peopleSearch"
        placeholder="#{msgs['jsf.people.SearchPlaceholder']}"
        actionBean="#{projectHomeAction.peopleFilterComparator}"/>
    </div>

    <a4j:status name="peopleTab-peopleLoader">
      <f:facet name="start">
        <zanata:loader/>
      </f:facet>
    </a4j:status>

    <h:form id="people_form" styleClass="l--push-bottom-1">

      <s:div styleClass="l--pad-all-half"
        rendered="#{empty projectHomeAction.allMembers}">
        <p class="txt--meta">#{msgs['jsf.NoPeople']}</p>
        <s:fragment rendered="#{canManageMembers}">
          <p>
            <button class="button button--primary"
              data-toggle="modal"
              data-target="#modal-add-someone">
              <i class="i i--plus"></i> #{msgs['jsf.people.AddSomeone']}
            </button>
          </p>
        </s:fragment>
      </s:div>

      <s:div styleClass="l--pad-all-half"
        rendered="#{not empty projectHomeAction.allMembers and empty projectHomeAction.peopleFilterComparator.currentPage}">
        <p class="txt--meta">#{msgs['jsf.search.NoResult']}</p>
      </s:div>

      <s:fragment
        rendered="#{!projectHomeAction.peopleFilterComparator.currentPage.isEmpty()}">

        <s:fragment rendered="#{projectHomeAction.peopleFilterComparator.isShowMembersInGroup()}">
          <s:div styleClass="l--pad-h-half" rendered="#{not empty projectHomeAction.peopleFilterComparator.getMaintainers()}">
            <h4>#{msgs['jsf.project.peoplelist.project.label']} <span class="txt--understated">#{projectHomeAction.peopleFilterComparator.getMaintainers().size}</span></h4>
            <ul class="list--slat l--push-all-half">
              <ui:repeat value="#{projectHomeAction.peopleFilterComparator.getMaintainers()}" var="person">
                <zanata:people-entry person="#{person}"
                  manageMembersDialogId="modal-manage-permissions"
                  roles="#{projectHomeAction.projectRolesDisplayName(person)}"
                  canManageMembers="#{canManageMembers}"/>
              </ui:repeat>
            </ul>
          </s:div>

          <s:div styleClass="l--pad-h-half" rendered="#{not empty projectHomeAction.peopleFilterComparator.getTranslators()}">
            <h4>#{msgs['jsf.project.peoplelist.translation.label']} <span class="txt--understated">#{projectHomeAction.peopleFilterComparator.getTranslators().size}</span></h4>
            <ul class="list--slat l--push-all-half">
              <ui:repeat value="#{projectHomeAction.peopleFilterComparator.getTranslators()}" var="person">
                <!-- loop through all locale in project -->
                <!-- is person is in locale, display -->
              </ui:repeat>
            </ul>

          </s:div>
        </s:fragment>

        <s:fragment rendered="#{not projectHomeAction.peopleFilterComparator.isShowMembersInGroup()}">
          <ul class="list--slat l--push-all-half">
            <ui:repeat value="#{projectHomeAction.peopleFilterComparator.currentPage}" var="person">
              <zanata:people-entry person="#{person}"
                manageMembersDialogId="modal-manage-permissions"
                roles="#{projectHomeAction.rolesDisplayName(person)}"
                canManageMembers="#{canManageMembers}"/>
            </ui:repeat>
          </ul>
        </s:fragment>
      </s:fragment>
    </h:form>
    <zanata:list-filter status="peopleTab-peopleLoader"
      listId="people_form" iconClass="i--users"
      render="people_form, peopleSearch-pager, peopleSearch-page-info"
      id="peopleSearchBottom" bottomPanel="true"
      placeholder="#{msgs['jsf.people.SearchPlaceholder']}"
      actionBean="#{projectHomeAction.peopleFilterComparator}"/>
  </div>

</ui:composition>
